<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>GitUtil Mobile</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
--ink-900:#0d1821;--ink-700:#344055;--ink-500:#5f6c7b;--ink-300:#9199a1;
--sky-600:#1b6ca8;--sky-500:#2e8bc0;--sky-400:#89c2d9;
--grass-600:#2d6a4f;--grass-500:#40916c;
--fire-600:#d62828;--fire-500:#f77f00;
--pearl-100:#f1faee;--pearl-50:#ffffff;
--gap:8px;--curve:12px;--press-zone:54px
}
body{
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;
background:var(--pearl-100);color:var(--ink-900);line-height:1.5;font-size:16px
}
.widget-shell{max-width:750px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
.masthead{
background:linear-gradient(135deg,var(--sky-600),var(--sky-500));
color:var(--pearl-50);padding:calc(var(--gap)*2.5);box-shadow:0 2px 10px rgba(0,0,0,0.15);
position:sticky;top:0;z-index:100
}
.masthead h1{font-size:24px;font-weight:700;letter-spacing:-0.5px}
.masthead p{font-size:13px;opacity:0.9;margin-top:4px}
.canvas{flex:1;padding:calc(var(--gap)*2)}
.card{
background:var(--pearl-50);border-radius:var(--curve);
padding:calc(var(--gap)*2.5);margin-bottom:calc(var(--gap)*2);
box-shadow:0 1px 4px rgba(0,0,0,0.08)
}
.card__header{font-size:19px;font-weight:650;margin-bottom:calc(var(--gap)*2);color:var(--sky-600)}
.input-zone{margin-bottom:calc(var(--gap)*2.5)}
.input-zone__label{display:block;font-size:14px;font-weight:550;margin-bottom:var(--gap);color:var(--ink-700)}
.text-box{
width:100%;padding:calc(var(--gap)*1.75) calc(var(--gap)*2);font-size:16px;
border:2px solid var(--ink-300);border-radius:calc(var(--curve)*0.7);
background:var(--pearl-50);transition:border-color 0.2s;font-family:inherit
}
.text-box:focus{outline:none;border-color:var(--sky-400)}
.action-btn{
width:100%;min-height:var(--press-zone);padding:calc(var(--gap)*2) calc(var(--gap)*3);
font-size:17px;font-weight:600;border:none;border-radius:calc(var(--curve)*0.7);
cursor:pointer;transition:transform 0.1s,opacity 0.2s;display:flex;align-items:center;
justify-content:center;gap:var(--gap);box-shadow:0 2px 6px rgba(0,0,0,0.1);font-family:inherit
}
.action-btn:active{transform:scale(0.96)}
.btn-primary{background:var(--sky-500);color:var(--pearl-50)}
.btn-success{background:var(--grass-500);color:var(--pearl-50)}
.btn-danger{background:var(--fire-600);color:var(--pearl-50)}
.btn-neutral{background:var(--pearl-50);color:var(--ink-900);border:2px solid var(--ink-300)}
.btn-locked{opacity:0.4;pointer-events:none}
.timeline-zone{max-height:56vh;overflow-y:auto;-webkit-overflow-scrolling:touch;margin-bottom:calc(var(--gap)*2)}
.snapshot-card{
background:var(--pearl-100);border:2px solid var(--ink-300);
border-radius:calc(var(--curve)*0.8);padding:calc(var(--gap)*2);
margin-bottom:calc(var(--gap)*1.5);cursor:pointer;transition:all 0.15s;position:relative
}
.snapshot-card:active{background:#dde5ed;border-color:var(--sky-500)}
.snapshot-card.active-pick{border-color:var(--sky-600);background:#d4e7f5}
.snapshot-card__hash{
font-family:'Courier New',monospace;font-size:13px;
color:var(--ink-500);margin-bottom:calc(var(--gap)*0.5)
}
.snapshot-card__msg{font-size:15px;font-weight:520;margin-bottom:var(--gap);line-height:1.3}
.snapshot-card__meta{display:flex;gap:calc(var(--gap)*1.5);flex-wrap:wrap;font-size:13px;color:var(--ink-500)}
.meta-piece{display:inline-flex;align-items:center;gap:4px}
.notice-bar{
padding:calc(var(--gap)*1.75) calc(var(--gap)*2);border-radius:calc(var(--curve)*0.7);
margin-bottom:calc(var(--gap)*2);font-size:14px;line-height:1.4
}
.notice-info{background:#cfe2ff;color:#084298;border-left:4px solid var(--sky-500)}
.notice-good{background:#d1e7dd;color:#0f5132;border-left:4px solid var(--grass-600)}
.notice-bad{background:#f8d7da;color:#842029;border-left:4px solid var(--fire-600)}
.notice-alert{background:#fff3cd;color:#664d03;border-left:4px solid var(--fire-500)}
.spin-wheel{
display:inline-block;width:18px;height:18px;border:3px solid rgba(255,255,255,0.3);
border-top-color:var(--pearl-50);border-radius:50%;animation:rotate-spin 0.8s linear infinite
}
@keyframes rotate-spin{to{transform:rotate(360deg)}}
.screen-off{display:none}
.btn-row{display:flex;gap:calc(var(--gap)*1.5);margin-top:calc(var(--gap)*2)}
.btn-row .action-btn{flex:1}
.void-box{text-align:center;padding:calc(var(--gap)*5) calc(var(--gap)*2.5);color:var(--ink-500)}
.void-box__icon{font-size:48px;margin-bottom:calc(var(--gap)*1.5);opacity:0.4}
</style>
</head>
<body>
<div class="widget-shell">
<header class="masthead">
<h1>GitUtil Mobile</h1>
<p>Git commit browser and rollback tool</p>
</header>
<main class="canvas">
<div id="locationPicker" class="view-mode">
<div class="card">
<h2 class="card__header">Repository Location</h2>
<div class="input-zone">
<label class="input-zone__label">Full Path</label>
<input type="text" id="locationBox" class="text-box" placeholder="/sdcard/git/my-project">
</div>
<button id="verifyBtn" class="action-btn btn-primary"><span>Verify Location</span></button>
</div>
<div id="locationMsg"></div>
</div>
<div id="timelineViewer" class="view-mode screen-off">
<div class="card">
<h2 class="card__header">Timeline Browser</h2>
<div id="pathDisplay" class="notice-bar notice-info"></div>
<div id="snapshotList" class="timeline-zone"></div>
<div class="btn-row">
<button id="rollbackBtn" class="action-btn btn-danger btn-locked">Apply Rollback</button>
<button id="switchBtn" class="action-btn btn-neutral">Change Location</button>
</div>
</div>
<div id="rollbackMsg"></div>
</div>
</main>
</div>
<script>
const WidgetState={loc:'',snapshots:[],picked:null};
const Nodes={
locationBox:document.getElementById('locationBox'),
verifyBtn:document.getElementById('verifyBtn'),
locationMsg:document.getElementById('locationMsg'),
locationPicker:document.getElementById('locationPicker'),
timelineViewer:document.getElementById('timelineViewer'),
pathDisplay:document.getElementById('pathDisplay'),
snapshotList:document.getElementById('snapshotList'),
rollbackBtn:document.getElementById('rollbackBtn'),
switchBtn:document.getElementById('switchBtn'),
rollbackMsg:document.getElementById('rollbackMsg')
};
const showMsg=(target,txt,kind)=>{
target.innerHTML=`<div class="notice-bar notice-${kind}">${txt}</div>`;
};
const hideMsg=(target)=>{target.innerHTML='';};
const switchView=(view)=>{
Nodes.locationPicker.classList.add('screen-off');
Nodes.timelineViewer.classList.add('screen-off');
view.classList.remove('screen-off');
};
const setBusy=(btn,busy)=>{
if(busy){
btn.classList.add('btn-locked');
btn.dataset.orig=btn.innerHTML;
btn.innerHTML='<span class="spin-wheel"></span><span>Processing...</span>';
}else{
btn.classList.remove('btn-locked');
if(btn.dataset.orig)btn.innerHTML=btn.dataset.orig;
}
};
const callWrapper=async(wrapperName,args=[])=>{
try{
const response=await fetch('http://localhost:8765/exec-wrapper',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({wrapper:wrapperName,args:args})
});
if(!response.ok){
throw new Error(`Server error: ${response.status}`);
}
const result=await response.json();
return result;
}catch(err){
console.error('Wrapper execution failed:',err);
return{success:false,output:`Connection failed: ${err.message}`};
}
};
const parseSnapshots=(raw)=>{
const blocks=raw.split('SNAPSHOT_BEGIN').filter(b=>b.trim());
return blocks.map(b=>{
const lines=b.split('\n');
const snap={};
lines.forEach(ln=>{
if(ln.startsWith('IDENTIFIER:'))snap.hash=ln.substring(11).trim();
if(ln.startsWith('CONTRIBUTOR:'))snap.who=ln.substring(12).trim();
if(ln.startsWith('WHEN:'))snap.when=new Date(parseInt(ln.substring(5).trim())*1000).toLocaleString();
if(ln.startsWith('TITLE:'))snap.title=ln.substring(6).trim();
});
if(snap.hash)snap.short=snap.hash.substring(0,8);
return snap;
}).filter(s=>s.hash&&s.title);
};
const renderSnapshots=(snaps)=>{
Nodes.snapshotList.innerHTML='';
if(snaps.length===0){
Nodes.snapshotList.innerHTML='<div class="void-box"><div class="void-box__icon">üì≠</div><div>No snapshots found</div></div>';
return;
}
snaps.forEach(s=>{
const card=document.createElement('div');
card.className='snapshot-card';
card.dataset.hash=s.hash;
card.innerHTML=`
<div class="snapshot-card__hash">${s.short}</div>
<div class="snapshot-card__msg">${s.title.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
<div class="snapshot-card__meta">
<span class="meta-piece">üë§ ${s.who.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</span>
<span class="meta-piece">‚è∞ ${s.when}</span>
</div>`;
card.onclick=()=>{
WidgetState.picked=s.hash;
document.querySelectorAll('.snapshot-card').forEach(c=>c.classList.remove('active-pick'));
card.classList.add('active-pick');
Nodes.rollbackBtn.classList.remove('btn-locked');
};
Nodes.snapshotList.appendChild(card);
});
};
Nodes.verifyBtn.onclick=async()=>{
const loc=Nodes.locationBox.value.trim();
if(!loc){showMsg(Nodes.locationMsg,'Please enter a path','bad');return;}
hideMsg(Nodes.locationMsg);
setBusy(Nodes.verifyBtn,true);
try{
const res=await callWrapper('check-location',[loc]);
if(res.success&&res.output.includes('VALID')){
WidgetState.loc=loc;
const timelineRes=await callWrapper('pull-timeline',[loc]);
if(timelineRes.success){
WidgetState.snapshots=parseSnapshots(timelineRes.output);
Nodes.pathDisplay.textContent=`Location: ${loc}`;
renderSnapshots(WidgetState.snapshots);
switchView(Nodes.timelineViewer);
hideMsg(Nodes.rollbackMsg);
}else{
showMsg(Nodes.locationMsg,'Failed to fetch timeline','bad');
}
}else{
showMsg(Nodes.locationMsg,'Invalid repository location','bad');
}
}catch(e){
showMsg(Nodes.locationMsg,`Error: ${e.message}`,'bad');
}finally{
setBusy(Nodes.verifyBtn,false);
}
};
Nodes.rollbackBtn.onclick=async()=>{
if(!WidgetState.picked)return;
if(!confirm(`‚ö†Ô∏è WARNING\n\nRolling back to ${WidgetState.picked.substring(0,8)} will reset your branch.\nUncommitted changes will be lost.\n\nProceed?`))return;
hideMsg(Nodes.rollbackMsg);
setBusy(Nodes.rollbackBtn,true);
try{
const res=await callWrapper('apply-rollback',[WidgetState.loc,WidgetState.picked]);
if(res.success&&res.output.includes('SUCCESS')){
showMsg(Nodes.rollbackMsg,`‚úì Rolled back to ${WidgetState.picked.substring(0,8)}`,'good');
setTimeout(async()=>{
const refresh=await callWrapper('pull-timeline',[WidgetState.loc]);
if(refresh.success){
WidgetState.snapshots=parseSnapshots(refresh.output);
renderSnapshots(WidgetState.snapshots);
}
},1500);
}else{
showMsg(Nodes.rollbackMsg,'Rollback failed','bad');
}
}catch(e){
showMsg(Nodes.rollbackMsg,`Error: ${e.message}`,'bad');
}finally{
setBusy(Nodes.rollbackBtn,false);
}
};
Nodes.switchBtn.onclick=()=>{
WidgetState.loc='';WidgetState.snapshots=[];WidgetState.picked=null;
Nodes.locationBox.value='';hideMsg(Nodes.locationMsg);
switchView(Nodes.locationPicker);
};
Nodes.locationBox.onkeypress=(e)=>{if(e.key==='Enter')Nodes.verifyBtn.click();};
window.onload=()=>{
const saved=localStorage.getItem('gitutil_last_loc');
if(saved)Nodes.locationBox.value=saved;
};
window.onbeforeunload=()=>{
if(WidgetState.loc)localStorage.setItem('gitutil_last_loc',WidgetState.loc);
};
</script>
</body>
</html>
